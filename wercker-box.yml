name:     'rvm-phantomjs'
version:  0.0.3
inherits: wercker/rvm@8.0.0
platform: ubuntu@12.04
type:     main
keywords:
  - rvm
  - phantomjs
script: |
  sudo apt-get update
  cd /tmp
  wget https://bitbucket.org/ariya/phantomjs/downloads/phantomjs-2.1.1-linux-x86_64.tar.bz2
  tar xfj phantomjs-2.1.1-linux-x86_64.tar.bz2
  sudo cp /tmp/phantomjs-2.1.1-linux-x86_64/bin/phantomjs /usr/local/bin

  # Start xvfb which gives the context an virtual display
  # which is required for tests that require an GUI
  sudo apt-get install libsasl2-2 libsasl2-dev
  start-stop-daemon --start --quiet --pidfile /tmp/xvfb_99.pid --make-pidfile --background --exec /usr/bin/Xvfb -- :99 -screen 0 1024x768x24 -ac +extension GLX +render -noreset
  # Give xvfb time to start. 3 seconds is the default for all xvfb-run commands.
  sleep 3

env:
  DISPLAY: ":99.0"
